# 연관관계 매핑 기초

## 양방향 연관관계와 연관관계의 주인 2 - 주의점, 정리

### 주의점

- 가장 많이 하는 실수 - 연관관계의 주인에 값을 입력하지 않음.
- 양방향 매핑시 양쪽에 값을 넣어주자. - 객체 지향적으로 생각해보자.
    - 영속성 컨텍스트에 올라가 있는 값과 안 올라가있는 값이 존재.
    - 1차캐시에 올라가있을경우 DB에 select를 하지 않으므로 값이 조회되지 않는다.
- 연관관계 편의 메소드를 만들자.(한쪽만)
    - team.getMembers().add(this)
    - 로직이 들어갈 경우 이름을 바꾸는것도 권장
- 양방향 매핑시에 무한 루프를 조심하자.
    - 양쪽에서  toString 계속 호출
    - Controller에서 Entity를 반환하지 말자. → DTO로 변환해서 반환. → 실무에서 대부분의 많은 에러해결.

### 양방향 매핑 정리

- 단방향 매핑만으로도 이미 연관관계 매핑은 완료.
- 양방향 매핑은 반대 방향으로 조회(객체 그래프 탐색)기능이 추가 된 것 뿐.
- JPQL에서 역방향으로 탐색할 일이 많음.
- 단방향 매핑을 잘 하고 양방향은 필요할 때 추가해도 됨(테이블에 영향X)
- **연관관계의 주인은 외래키의 위치를 기준으로 정해야함**

## 실전 예제 - 2. 연관관계 매핑 시작

```java
Order order = new Order();
=======================================
order.addOrderItem(new orderItem());
========================================
em.persist(order);

OrderItem orderItem = new OrderITem();
orderItem.setOrder(order);

em.persist(orderItem);
```

- 양방향 연관관계가 아니라도 애플리케이션 개발에 문제는 없다.
- but, 개발상의 편의 및 조회