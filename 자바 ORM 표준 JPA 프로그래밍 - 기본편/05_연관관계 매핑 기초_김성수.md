# 연관 관계 매핑 기초

## 목표

- 객체와 테이블 연관 관계의 차이를 이해
- 객체의 참조와 테이블의 외래키를 매핑
- 용어 이해
    - 방향 : 단방향, 양방향
    - 다중성 : 다대일(N:1), 일대다(1:N), 일대일(1:1), 다대다(N:M) 이해
    - 연관 관계의 주인 : 객체 양방향 연관 관계는 관리 주인이 필요

### Member

@ManyToOne ( Member.Class)

@JoinColumn (Column = Team_ID)

### Team

@OneToMany(mappedBy = “team”) : mappedBy = “변수명”

### 연관 관계의 주인과 mappedBy

- mappedBy = JPA의 멘탈붕괴 난이도
- 객체와 테이블간의 연관관계를 맺는 차이.
    - 객체 연관 관계 = 2개(서로 다른 단방향 관계 2개)
        - 회원 → 팀(단 방향)
        - 팀 → 회원(단 방향)
    - 테이블 연관 관계 = 1 개(외래 키 하나로 두 테이블 연관 관계 관리)
        - 회원 ↔ 팀(양 방향)

### 둘 중 하나로 외래 키를 관리해야 한다!

### 연관 관계의 주인

- 객체의 두 관계중 하나를 연관 관계의 주인으로 지정
- 연관 관계의 주인만이 외래 키를 관리(등록, 수정)
- 주인이 아닌쪽은 읽기만 가능
- 주인은 mappedBy 속성 사용x
- 주인이 아니면 mappedBy 속성으로 주인 지정

### 외래 키가 있는 곳을 주인으로 지정!!  ()

- ManyToOne(N:1) N쪽이 주인이 된다.
- 비즈니스적으로 중요하다는 의미는 아님!

### 양방향 매핑시 가장 많이 하는 실수

- 연관 관계의 주인의 값을 입력하지 않음 (Null)
- 순수한 객체 관계를 고려하면 양쪽 다 값을 입력해야 한다.
- 양방향 매핑시에 무한 루프 주의!(toString(), lombok→toString() 자동 생성 주의, JSON 생성 라이브러리→ 컨트롤러에서는 Entity를 절대 반환x, 순수한 값만 가지고있는 DTO로 변환해서 반환하는 것을 추천 )
- 연관관계 편의 메소드를 생성하자.
    
    ```java
    Class Member{
    	.
    	.
    	//관례에 의한 setter가 아님을 알 수 있도록 메소드 이름 지정
    	public void changeTeam(Team team){ 
    		this.team = team;
    		team.getMembers().add(this)
    	}
    }
    ```
    
    ### 양방향 매핑 정리
    
    - 단방향 매핑만으로도 이미 연관관계 매핑은 완료!! (객체-테이블 매핑 완료)
    - 양방향 매핑은 반대 방향으로 조회(객체 그래프 탐색) 기능이 추가 된 것 뿐
    - JQPL에서 역방향으로 탐색할 일이 많음
    - 단방향 매핑을 잘 하고 양방향은 필요할 때 추가해도 됨(테이블에 영향을 주지 않음)