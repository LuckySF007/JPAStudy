# 연관관계 매핑 기초

## 단방향 연관관계

### 용어 이해

- 방향(Direction) : 단방향, 양방향
- 다중성(Multiplicity) : 다대일(N:1), 일대다(1:N), 일대일(1:1), 다대다(N:M) 이해
- 연관관계의 주인(Owner) : 객체 양방향 연관관계는 관리 주인이 필요(★)

### 연관관계가 필요한 이유

- **객체지향 설계의 목표는 자율적인 객체들의 협력 공동체를 만드는 것이다. - 조영호(객체지향의 사실과 이해)**
- 객체를 테이블에 맞추어 모델링 → 객체 그래프 탐색 불가
- 조회 : 식별자로 다시 조회, 상당히 번거롭다.
- 데이터 중심 모델링 하면  협력 관계를 만들 수 없다.
- 테이블은 외래 키 조인, 객체는 참조

### 단방향 연관관계

- @ManyToOne : 객체 입장에서 참조하는 객체와의 DB에서 관계, N : 1
    - fetch : 지연로딩전략, 추후 설명
- @JoinColumn : 이 관계를 할 때 조인하는 컬럼명
- 삽입, 조회, 수정 모두 객체지향스러워진다.

## 양방향 연관관계와 연관관계의 주인 1 - 기본

### 양방향 매핑

- 테이블 구조에서는 변경되는 점이 없다. JOIN을 사용하면 그대로 가능. → 외래키는 결국 양방향
- Member 입장에서는 단방향과 똑같다.
- Team 입장
    - 컬렉션 추가 - List<Member> members
    - @OneToMany(mappedBy = “team(Member 클래스에 있는 Team 변수명)”
- 객체는 단방향이 더 좋다.

### 연관관계의 주인과 mappedBy

- 객체와 테이블간에 연관관계를 맺는 차이를 이해해야 한다.
- 객체 연관관계 = 2개
    - 회원 → 팀 연관관계 1개(단방향)
    - 팀 → 회원 연관관계 1개(단방향)
- 테이블 연관관계 = 1개
    - 회원 ↔ 팀의 연관관계 1개(양방향)

### 객체의 양방향 관계

- 사실 객체의 양방향 관계는 서로 다른 단방향 2개

### 테이블의 양방향 연관관계

- 테이블은 외래 키 하나로 두테이블의 연관관계를 관리

### 연관관계의 주인(Owner)

- 양방향 매핑 규칙
- 객체의 두 관계중 하나를 연관관계의 주인
- 주인이 외래키를 관리(등록, 수정)
- 주인이 아닌쪽은 읽기만 가능
- 주인은 mappedBy 속성 사용 X
- 주인이 아니면 mappedBy
- 외래 키가 있는 곳을 주인으로 정해라.(★)
- ~ToOne 이 연관관계의 주인이 된다.