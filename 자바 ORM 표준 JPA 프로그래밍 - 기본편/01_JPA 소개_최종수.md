# JPA소개

## SQL 중심적인 개발의 문제점

- 최근 개발 언어 : 객체 지향 언어
- 데이터베이스 : 관계형 DB
- SQL 중심의 개발의 문제점
    - 무한 반복, 지루한 코드
    - 컬럼 추가 될 경우, 너무 많은 수정 작업을 요한다 → 생산성이 떨어짐.
    - SQL에 의존적인 개발을 피하기 어렵다.
- 패러다임의 불일치
    - 객체 지향 프로그래밍 : 추상화, 캡슐화, 정보은닉, 상속, 다형성
    - 객체를 영구 보관하는 다양한 저장소가 있지만 결국 RDB를 선택하게 된다.(현실적인 대안)
    - 객체 → SQL변환 → SQL : 개발자가 결국 SQL매퍼
- 객체와 관계형 데이터베이스의 차이
    - 상속 : 객체 상속 관계 ↔ Table 슈퍼타입 서브타입 관계
    - 삽입과 조회가 매우 복잡해진다.
    - 연관관계 : 객체는 참조를 사용(단방향), 테이블은 외래 키를 사용(양방향)
    - 객체를 테이블에 맞춰 모델링 → 객체 답지 못하다.
- 객체 모델링, 자바컬렉션에 관리
    - SQL과 엮일 경우 생산성이 떨어짐.
- 객체 그래프 탐색이 자유롭게 이뤄져야 한다.
    - 하지만, 처음 실행하는 SQL에 따라 탐색 범위 결정 → 자유롭지 못하다. → 엔티티 신뢰 문제
- **진정한 의미의 계층 분할이 어렵다. 논리적 강결합.**
- 객체답게 모델링 → 매핑 작업만 늘어난다.

## JPA 소개

### JPA?

- Java Persistence API
- 자바 진영의 ORM 기술 표준

### ORM?

- Object-relational mapping(객체 관계 매핑)
- 객체는 객체대로 RDB 는 RDB 대로 설계
- ORM 프레임워크가 중간에 매핑
- 대중적인 언어는 대부분 ORM 존재

### 동작

- JPA는 애플리케이션과 JDBC 사이에서 동작
- 저장(persist)
    - Entity 분석
    - Insert SQL 생성
    - JDBC API 사용
    - **패러다임 불일치 해결**
- 조회(find)
    - SELECT SQL 생성
    - JDBC API 사용
    - ResultSet 매핑
    - **패러다임 불일치 해결**

### JPA 소개

- EJB - 엔티티빈(자바표준) → 하이버네이트(오픈 소스) → JPA(자바 표준) (Gavin King)
- JPA는 표준 명세, 인터페이스의 모음
    - Hibernate(★), EclipseLink, DataNucleus
- 버전
    - 1.0(2006) : 초기버전, 복합 키와 연관관계 기능이 부족
    - 2.0(2009) : 대부분의 ORM 기능을 포함, JPA Criteria 추가
    - 2.1(2013) : 스토어드 프로시저 접근, 컨버터(Converter), 엔티티 그래프 기능이 추가

### JPA를 왜 사용해야 하는가?

- SQL 중심 → 객체 중심
- 생산성
    - 저장 : jpa.persist
    - 조회 : Object obj = jpa.find
    - 수정 : obj.set → 따로 저장하지 않아도 업데이트(자바 컬렉션 생각)
    - 삭제 : jpa.remove(obj)
- 유지보수
    - 기존 : 필드 변경시 모든 SQL 수정
    - JPA : 필드만 추가, 나머지는 JPA 가
- **패러다임의 불일치 해결**
    - JPA와 상속
        - 저장 : 개발자는 저장 한문장, 나머지는 JPA가 처리
        - 조회 : 개발자 조회 시도, JPA가 알아서 JOIN
    - JPA와 연관관계
        - 연관관계 저장 → 객체 그래프 탐색 가능 → 신뢰할 수 있는 엔티티, 계층
        - 동일한 트랜잭션에서 조회한 엔티티는 같음을 보장
- 성능
    - 1차 캐시와 동일성 보장
        - 같은 트랜잭션 안에서는 같은 엔티티를 반환 - 약간의 조회 성능 향상
            - 처음 조회 SQL, 두번째 조회 캐싱
    - 트랜잭션을 지원하는 쓰기 지연
        - INSERT : 트랜잭션을 커밋할때까지 SQL 모음, JDBC BATCH SQL 기능을 사용해서 한번에 SQL  전송
    - 지연 로딩 : 객체가 실제 사용될 때 로딩
        - 연관된 객체는 사용될 때 SELECT
    - 즉시 로딩 : JOIN SQL로 한번에 연관된 객체끼리 미리 조회(옵션 킬 경우)
- 데이터 접근 추상화와 벤더 독립성
- 표준