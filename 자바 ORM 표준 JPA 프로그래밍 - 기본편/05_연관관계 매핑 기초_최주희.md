# 05.연관관계 매핑 기초

## 단방향 연관관계 매핑

하나의 테이블에서 다른 테이블로 그래프 탐색을 할 수 있게끔 매핑

(테이블의 연관관계가 n:1 일 경우에 @ManyToOne으로 매핑한 후에 @JoinColumn 을 지정)

<br>

## 양방향 연관관계 매핑

- 두개의 테이블이 서로 탐색할 수 있게끔 매핑할 수 있음
- 한쪽 테이블에만 외래키와 있는 것과는 다르게 두 테이블 모두에서 서로를 참조 가능
- 객체 참조와 테이블의 외래키의 가장 큰 차이점
- 테이블의 연관관계가 1:n일 때 @OneToMany 로 매핑하여 리스트 컬렉션으로 가지고 있을 수 있음

<br>

## 객체와 테이블이 관계를 맺는 차이

- 객체 연관관계 = 2개 (객체의 양방향 관계는 사실 서로 다른 단방향 2개)
    - 회원 → 팀 연관관계 1개(단방향)
    - 팀 → 회원 연관관계 1개 (단방향)
- 테이블 연관간계 = 1개 (한 테이블의 외래키 하나로 조인문을 통해 서로의 모든 데이터를 조회가능)
    - 회원 ↔ 팀 연관관계 1개(양방향)

<br>

## 연관관계의 주인

- 양방향 매핑 규칙
    - 객체의 두 관계중 하나를 연관관계의 주인으로 지정
    - **연관관계 주인만이 외래키 관리(등록, 수정), 주인이 아닌쪽은 읽기만 가능**
    - 주인(진짜 매핑)은 mappedBy 속성 사용 x, 주인이 아닌쪽(가짜 매핑)은 mappedBy 속성으로 주인 지정
- **외래키가 있는 곳을 주인으로 지정해라. (ManyToOne)**

<br>

## 양방향 연관관계 시 주의할점

- 양방향 매핑 시 순수한 객체 관계를 고려하면 항상 양쪽다 값을 입력해주어야함
- 연관관계 편의 메소드를 생성하자.
    - 한쪽에만 생성, 두쪽에 다 하면 무한루프 가능성 있음
- 양방향 매핑 시 무한루프 조심 : 예를 들어 toString(), lombok, JSON 생성 라이브러리 사용 시
- 단방향 매핑을 잘 하고 양방향은 필요할 때 추가해도 됨(테이블에 영향을 주지 않음)